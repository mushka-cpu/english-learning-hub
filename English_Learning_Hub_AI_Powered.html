<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Learning Hub - AI Powered</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #00b894, #00d2d3);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            color: #667eea;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .back-button:hover {
            background: #667eea;
            color: white;
        }
        
        .api-setup {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: none;
        }
        
        .api-setup.show {
            display: block;
        }
        
        .api-setup h3 {
            margin-bottom: 15px;
        }
        
        .api-input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .api-input-group input {
            flex: 1;
            min-width: 250px;
            padding: 12px;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 15px;
        }
        
        .api-input-group button {
            padding: 12px 30px;
            background: white;
            color: #e17055;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }
        
        .ai-powered {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #00b894, #00d2d3);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .feature-icon {
            font-size: 40px;
            margin-bottom: 15px;
        }
        
        .feature-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .feature-desc {
            color: #666;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .content-panel {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
        }
        
        .content-panel.active {
            display: block;
        }
        
        .chat-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
        }
        
        .message.ai {
            background: white;
            border: 2px solid #e9ecef;
        }
        
        .message-input {
            display: flex;
            gap: 10px;
        }
        
        .message-input textarea {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }
        
        .message-input button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            align-self: flex-end;
        }
        
        .message-input button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .essay-input {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            margin-bottom: 15px;
        }
        
        .feedback-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 5px solid #00b894;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        button:hover:not(:disabled) {
            transform: scale(1.02);
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #00b894;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .practice-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .practice-option {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ddd;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .practice-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .practice-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .grammar-reference {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .grammar-category {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .grammar-category:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .grammar-category h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .grammar-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        .grammar-content.show {
            display: block;
        }
        
        .example {
            background: #f0f4ff;
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
            font-style: italic;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #dc3545;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .message {
                max-width: 90%;
            }
            
            .back-button {
                position: static;
                display: inline-block;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">‚Üê Back to Home</a>
    
    <div class="container">
        <div class="header">
            <h1>üß† English Learning Hub</h1>
            <div class="ai-badge">ü§ñ AI-Powered by Claude</div>
            <p style="margin-top: 10px; color: #666;">Your Personal English Teacher with Artificial Intelligence</p>
        </div>
        
        <!-- API Setup Banner -->
        <div id="apiSetup" class="api-setup show">
            <h3>üîë Setup Your AI Teacher</h3>
            <p>Enter your Anthropic API key to unlock AI features:</p>
            <div class="api-input-group">
                <input type="password" id="apiKeyInput" placeholder="sk-ant-api03-xxxxx...">
                <button onclick="saveApiKey()">Save API Key</button>
            </div>
            <p style="margin-top: 10px; font-size: 13px;">
                Don't have one? Get it free at: <a href="https://console.anthropic.com" target="_blank" style="color: white; text-decoration: underline;">console.anthropic.com</a>
            </p>
        </div>
        
        <!-- Main Features Grid -->
        <div class="main-grid">
            <div class="feature-card" onclick="showPanel('grammar-reference')">
                <div class="feature-icon">üìñ</div>
                <div class="feature-title">Grammar Reference</div>
                <div class="feature-desc">Complete grammar guide with rules, examples, and common mistakes</div>
            </div>
            
            <div class="feature-card" onclick="showPanel('essay-checker')">
                <span class="ai-powered">AI</span>
                <div class="feature-icon">‚úçÔ∏è</div>
                <div class="feature-title">Essay Checker</div>
                <div class="feature-desc">AI analyzes your writing and gives detailed feedback on grammar, vocabulary, structure</div>
            </div>
            
            <div class="feature-card" onclick="showPanel('speaking-partner')">
                <span class="ai-powered">AI</span>
                <div class="feature-icon">üí¨</div>
                <div class="feature-title">Speaking Partner</div>
                <div class="feature-desc">Practice conversation with AI that asks questions and gives feedback</div>
            </div>
            
            <div class="feature-card" onclick="showPanel('grammar-helper')">
                <span class="ai-powered">AI</span>
                <div class="feature-icon">‚ùì</div>
                <div class="feature-title">Grammar Helper</div>
                <div class="feature-desc">Ask any grammar question and get clear explanations with examples</div>
            </div>
            
            <div class="feature-card" onclick="showPanel('vocabulary')">
                <span class="ai-powered">AI</span>
                <div class="feature-icon">üéØ</div>
                <div class="feature-title">Vocabulary Builder</div>
                <div class="feature-desc">AI generates personalized exercises based on your topics</div>
            </div>
            
            <div class="feature-card" onclick="showPanel('progress')">
                <div class="feature-icon">üìä</div>
                <div class="feature-title">Progress Tracker</div>
                <div class="feature-desc">See your learning statistics and AI-powered recommendations</div>
            </div>
        </div>
        
        <!-- Grammar Reference Panel -->
        <div id="grammar-reference-panel" class="content-panel">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìñ Complete Grammar Reference</h2>
            <p style="color: #666; margin-bottom: 25px;">Click on any topic to expand and see rules, examples, and tips</p>
            
            <div class="grammar-reference">
                <div class="grammar-category" onclick="toggleGrammar('tenses')">
                    <h3>‚è∞ Tenses (Present, Past, Future)</h3>
                    <p style="color: #666; font-size: 14px;">All 12 English tenses with formation and usage</p>
                    <div id="tenses" class="grammar-content">
                        <h4>Present Simple</h4>
                        <p><strong>Form:</strong> I/You/We/They + verb | He/She/It + verb+s</p>
                        <div class="example">I work every day. She works in an office.</div>
                        <p><strong>Use:</strong> Habits, facts, regular actions</p>
                        
                        <h4 style="margin-top: 20px;">Present Continuous</h4>
                        <p><strong>Form:</strong> am/is/are + verb+ing</p>
                        <div class="example">I am working now. They are studying English.</div>
                        <p><strong>Use:</strong> Actions happening now, temporary situations</p>
                        
                        <h4 style="margin-top: 20px;">Present Perfect</h4>
                        <p><strong>Form:</strong> have/has + past participle</p>
                        <div class="example">I have lived here for 5 years. She has visited Paris.</div>
                        <p><strong>Use:</strong> Past actions connected to present, experiences</p>
                        
                        <h4 style="margin-top: 20px;">Past Simple</h4>
                        <p><strong>Form:</strong> verb+ed (regular) or irregular form</p>
                        <div class="example">I worked yesterday. He went to London last week.</div>
                        <p><strong>Use:</strong> Completed actions in the past</p>
                    </div>
                </div>
                
                <div class="grammar-category" onclick="toggleGrammar('modals')">
                    <h3>üé≠ Modal Verbs</h3>
                    <p style="color: #666; font-size: 14px;">Can, could, may, might, must, should, would</p>
                    <div id="modals" class="grammar-content">
                        <h4>Can / Could</h4>
                        <p><strong>Ability:</strong> I can speak English. I could swim when I was young.</p>
                        <p><strong>Permission:</strong> Can I leave early? Could I use your phone?</p>
                        
                        <h4 style="margin-top: 20px;">Must / Have to</h4>
                        <p><strong>Obligation:</strong> You must wear a seatbelt. I have to work tomorrow.</p>
                        <div class="example">Must = strong personal obligation | Have to = external obligation</div>
                        
                        <h4 style="margin-top: 20px;">Should / Ought to</h4>
                        <p><strong>Advice:</strong> You should study more. You ought to see a doctor.</p>
                        
                        <h4 style="margin-top: 20px;">May / Might</h4>
                        <p><strong>Possibility:</strong> It may rain tomorrow. He might be late.</p>
                    </div>
                </div>
                
                <div class="grammar-category" onclick="toggleGrammar('passive')">
                    <h3>üîÑ Passive Voice</h3>
                    <p style="color: #666; font-size: 14px;">When the action is more important than who does it</p>
                    <div id="passive" class="grammar-content">
                        <h4>Formation: be + past participle</h4>
                        
                        <p><strong>Present:</strong> The car is washed every week.</p>
                        <p><strong>Past:</strong> The house was built in 1990.</p>
                        <p><strong>Present Perfect:</strong> The work has been finished.</p>
                        <p><strong>Future:</strong> The meeting will be held tomorrow.</p>
                        
                        <h4 style="margin-top: 20px;">When to use:</h4>
                        <p>1. When we don't know who did the action</p>
                        <div class="example">My bike was stolen. (We don't know who stole it)</div>
                        
                        <p style="margin-top: 10px;">2. When it's obvious or not important who did it</p>
                        <div class="example">The road is being repaired. (It's obvious - road workers)</div>
                        
                        <p style="margin-top: 10px;">3. In formal/scientific writing</p>
                        <div class="example">The experiment was conducted carefully.</div>
                    </div>
                </div>
                
                <div class="grammar-category" onclick="toggleGrammar('conditionals')">
                    <h3>üéØ Conditional Sentences</h3>
                    <p style="color: #666; font-size: 14px;">If clauses - Zero, First, Second, Third</p>
                    <div id="conditionals" class="grammar-content">
                        <h4>Zero Conditional (General truths)</h4>
                        <p><strong>Form:</strong> If + present, present</p>
                        <div class="example">If you heat water, it boils. (Always true)</div>
                        
                        <h4 style="margin-top: 20px;">First Conditional (Real future possibility)</h4>
                        <p><strong>Form:</strong> If + present, will + verb</p>
                        <div class="example">If it rains tomorrow, I will stay home.</div>
                        
                        <h4 style="margin-top: 20px;">Second Conditional (Unreal present/future)</h4>
                        <p><strong>Form:</strong> If + past simple, would + verb</p>
                        <div class="example">If I had a million dollars, I would buy a house. (But I don't have it)</div>
                        
                        <h4 style="margin-top: 20px;">Third Conditional (Unreal past)</h4>
                        <p><strong>Form:</strong> If + past perfect, would have + past participle</p>
                        <div class="example">If I had studied harder, I would have passed the exam. (But I didn't)</div>
                    </div>
                </div>
                
                <div class="grammar-category" onclick="toggleGrammar('articles')">
                    <h3>üìå Articles (a, an, the)</h3>
                    <p style="color: #666; font-size: 14px;">When to use and when not to use articles</p>
                    <div id="articles" class="grammar-content">
                        <h4>A / An (Indefinite articles)</h4>
                        <p><strong>Use A before consonant sounds:</strong> a book, a university</p>
                        <p><strong>Use AN before vowel sounds:</strong> an apple, an hour</p>
                        <div class="example">I saw a cat. (Not specific) | She's an engineer. (Job/profession)</div>
                        
                        <h4 style="margin-top: 20px;">The (Definite article)</h4>
                        <p><strong>When something is specific or already mentioned:</strong></p>
                        <div class="example">I saw a cat. The cat was black. (Now we know which cat)</div>
                        
                        <p style="margin-top: 10px;"><strong>With unique things:</strong> the sun, the moon, the internet</p>
                        <p><strong>With superlatives:</strong> the best, the tallest</p>
                        <p><strong>With rivers, oceans:</strong> the Thames, the Pacific</p>
                        
                        <h4 style="margin-top: 20px;">No article (Zero article)</h4>
                        <p><strong>Plural/uncountable in general:</strong> Dogs are friendly. Water is important.</p>
                        <p><strong>Countries (most):</strong> Russia, France (but: the USA, the UK)</p>
                        <p><strong>Languages:</strong> I speak English.</p>
                        <p><strong>Meals:</strong> breakfast, lunch, dinner</p>
                    </div>
                </div>
                
                <div class="grammar-category" onclick="toggleGrammar('prepositions')">
                    <h3>üìç Prepositions</h3>
                    <p style="color: #666; font-size: 14px;">Time, place, and movement prepositions</p>
                    <div id="prepositions" class="grammar-content">
                        <h4>Time Prepositions</h4>
                        <p><strong>IN:</strong> months, years, seasons, parts of day</p>
                        <div class="example">in January, in 2024, in summer, in the morning</div>
                        
                        <p style="margin-top: 10px;"><strong>ON:</strong> days, dates</p>
                        <div class="example">on Monday, on December 5th, on my birthday</div>
                        
                        <p style="margin-top: 10px;"><strong>AT:</strong> specific times</p>
                        <div class="example">at 3 o'clock, at night, at the moment</div>
                        
                        <h4 style="margin-top: 20px;">Place Prepositions</h4>
                        <p><strong>IN:</strong> inside, enclosed spaces</p>
                        <div class="example">in the room, in London, in the box</div>
                        
                        <p style="margin-top: 10px;"><strong>ON:</strong> surface</p>
                        <div class="example">on the table, on the wall, on the floor</div>
                        
                        <p style="margin-top: 10px;"><strong>AT:</strong> specific points</p>
                        <div class="example">at the door, at the station, at home</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Essay Checker Panel -->
        <div id="essay-checker-panel" class="content-panel">
            <h2 style="color: #667eea; margin-bottom: 10px;">‚úçÔ∏è AI Essay Checker</h2>
            <p style="color: #666; margin-bottom: 25px;">Paste your essay below and AI will analyze it for grammar, vocabulary, structure, and give you an IELTS-style band score</p>
            
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px;">
                <textarea id="essayInput" class="essay-input" placeholder="Write or paste your essay here...

Example prompt: Some people believe censorship is necessary to protect society, while others think it limits freedom of speech. Discuss both views and give your opinion.

Write at least 250 words..."></textarea>
                
                <button class="btn-primary" onclick="checkEssay()" id="checkEssayBtn">ü§ñ Check with AI</button>
                <button class="btn-secondary" onclick="clearEssay()">üóëÔ∏è Clear</button>
                
                <div id="essayFeedback"></div>
            </div>
        </div>
        
        <!-- Speaking Partner Panel -->
        <div id="speaking-partner-panel" class="content-panel">
            <h2 style="color: #667eea; margin-bottom: 10px;">üí¨ AI Speaking Partner</h2>
            <p style="color: #666; margin-bottom: 25px;">Practice speaking with AI! Choose a topic and the AI will ask you questions like in IELTS Speaking test</p>
            
            <div class="practice-selector">
                <div class="practice-option" onclick="selectTopic('part1')">
                    <div style="font-size: 30px;">üë§</div>
                    <strong>Part 1</strong>
                    <p style="font-size: 12px; margin-top: 5px;">General topics</p>
                </div>
                <div class="practice-option" onclick="selectTopic('part2')">
                    <div style="font-size: 30px;">üé§</div>
                    <strong>Part 2</strong>
                    <p style="font-size: 12px; margin-top: 5px;">Long turn</p>
                </div>
                <div class="practice-option" onclick="selectTopic('part3')">
                    <div style="font-size: 30px;">üí≠</div>
                    <strong>Part 3</strong>
                    <p style="font-size: 12px; margin-top: 5px;">Discussion</p>
                </div>
                <div class="practice-option" onclick="selectTopic('free')">
                    <div style="font-size: 30px;">üó£Ô∏è</div>
                    <strong>Free Talk</strong>
                    <p style="font-size: 12px; margin-top: 5px;">Any topic</p>
                </div>
            </div>
            
            <div id="speakingChat" class="chat-container"></div>
            
            <div class="message-input">
                <textarea id="speakingInput" placeholder="Type your answer here..." disabled></textarea>
                <button onclick="sendSpeakingMessage()" id="speakingSendBtn" disabled>Send</button>
            </div>
        </div>
        
        <!-- Grammar Helper Panel -->
        <div id="grammar-helper-panel" class="content-panel">
            <h2 style="color: #667eea; margin-bottom: 10px;">‚ùì AI Grammar Helper</h2>
            <p style="color: #666; margin-bottom: 25px;">Ask any grammar question and get clear, detailed explanations with examples</p>
            
            <div id="grammarChat" class="chat-container">
                <div class="message ai">
                    <strong>AI Grammar Teacher:</strong><br><br>
                    Hello! I'm your grammar helper. You can ask me things like:
                    <ul style="margin-top: 10px; margin-left: 20px;">
                        <li>When do I use Present Perfect vs Past Simple?</li>
                        <li>What's the difference between "used to" and "would"?</li>
                        <li>How do I form conditional sentences?</li>
                        <li>Can you explain passive voice?</li>
                    </ul>
                    What would you like to learn today?
                </div>
            </div>
            
            <div class="message-input">
                <textarea id="grammarInput" placeholder="Ask your grammar question..."></textarea>
                <button onclick="sendGrammarQuestion()" id="grammarSendBtn">Ask AI</button>
            </div>
        </div>
        
        <!-- Vocabulary Builder Panel -->
        <div id="vocabulary-panel" class="content-panel">
            <h2 style="color: #667eea; margin-bottom: 10px;">üéØ AI Vocabulary Builder</h2>
            <p style="color: #666; margin-bottom: 25px;">Enter a topic or paste a word list, and AI will generate personalized exercises</p>
            
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px;">
                <h3>Step 1: Choose or Enter Your Topic</h3>
                <input type="text" id="vocabTopic" placeholder="e.g., Business vocabulary, IELTS Politics, Crime and Law..." style="width: 100%; padding: 12px; margin: 15px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 15px;">
                
                <p style="margin: 20px 0; color: #666;">Or paste your word list:</p>
                <textarea id="vocabList" placeholder="entrepreneur - person who starts business
revenue - income from business
stakeholder - person with interest in company" style="width: 100%; min-height: 150px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 15px;"></textarea>
                
                <button class="btn-primary" onclick="generateVocabExercise()" id="vocabGenBtn">ü§ñ Generate AI Exercise</button>
                
                <div id="vocabExercise"></div>
            </div>
        </div>
        
        <!-- Progress Tracker Panel -->
        <div id="progress-panel" class="content-panel">
            <h2 style="color: #667eea; margin-bottom: 20px;">üìä Your Progress & AI Recommendations</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 36px; color: #667eea; font-weight: bold;">5</div>
                    <div style="color: #666;">Worksheets Available</div>
                </div>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 36px; color: #00b894; font-weight: bold;" id="aiUsage">0</div>
                    <div style="color: #666;">AI Interactions</div>
                </div>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 36px; color: #fdcb6e; font-weight: bold;">B2-C1</div>
                    <div style="color: #666;">Current Level</div>
                </div>
            </div>
            
            <button class="btn-primary" onclick="getAIRecommendations()" id="recommendBtn">ü§ñ Get AI Recommendations</button>
            
            <div id="recommendations"></div>
        </div>
    </div>
    
    <script>
        // Global variables
        let apiKey = localStorage.getItem('anthropic_api_key');
        let aiUsageCount = parseInt(localStorage.getItem('ai_usage_count') || '0');
        let currentSpeakingTopic = '';
        
        // CORS Proxy –¥–ª—è GitHub Pages
        const CORS_PROXY = 'https://corsproxy.io/?';
        
        // Initialize
        if (apiKey) {
            document.getElementById('apiSetup').classList.remove('show');
        }
        
        updateAIUsage();
        
        // Save API Key
        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            const key = input.value.trim();
            
            if (!key.startsWith('sk-ant-')) {
                alert('Invalid API key format. It should start with "sk-ant-"');
                return;
            }
            
            localStorage.setItem('anthropic_api_key', key);
            apiKey = key;
            document.getElementById('apiSetup').classList.remove('show');
            alert('‚úÖ API Key saved! AI features are now enabled!');
        }
        
        // Show panel
        function showPanel(panelName) {
            document.querySelectorAll('.content-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(panelName + '-panel').classList.add('active');
        }
        
        // Toggle grammar sections
        function toggleGrammar(id) {
            const content = document.getElementById(id);
            content.classList.toggle('show');
        }
        
        // Call Claude AI with CORS proxy
        async function callClaudeAI(prompt, systemPrompt = '') {
            if (!apiKey) {
                alert('Please set up your API key first!');
                showPanel('progress');
                document.getElementById('apiSetup').classList.add('show');
                return null;
            }
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS proxy
                const response = await fetch(CORS_PROXY + encodeURIComponent('https://api.anthropic.com/v1/messages'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 2000,
                        messages: [{
                            role: 'user',
                            content: prompt
                        }],
                        system: systemPrompt || undefined
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API call failed');
                }
                
                const data = await response.json();
                aiUsageCount++;
                updateAIUsage();
                
                return data.content[0].text;
            } catch (error) {
                console.error('AI Error:', error);
                
                // Show friendly error message
                const errorMsg = `
                    <div class="error-message">
                        <strong>‚ö†Ô∏è AI Error:</strong><br>
                        ${error.message}<br><br>
                        <strong>Possible solutions:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>Check your API key is correct</li>
                            <li>Ensure you have credits in your Anthropic account</li>
                            <li>Try again in a few seconds</li>
                            <li>Check your internet connection</li>
                        </ul>
                        <p style="margin-top: 10px;">For local testing without CORS issues, open this file directly from your computer (not through GitHub Pages).</p>
                    </div>
                `;
                
                return errorMsg;
            }
        }
        
        // Update AI usage count
        function updateAIUsage() {
            localStorage.setItem('ai_usage_count', aiUsageCount.toString());
            const elem = document.getElementById('aiUsage');
            if (elem) elem.textContent = aiUsageCount;
        }
        
        // Essay Checker
        async function checkEssay() {
            const essay = document.getElementById('essayInput').value.trim();
            
            if (!essay || essay.length < 50) {
                alert('Please write at least 50 words for the AI to analyze');
                return;
            }
            
            const feedback = document.getElementById('essayFeedback');
            const btn = document.getElementById('checkEssayBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Analyzing...';
            
            feedback.innerHTML = '<div class="loading"><div class="spinner"></div><p>AI is analyzing your essay...</p></div>';
            
            const prompt = `You are an expert IELTS examiner. Analyze this essay and provide detailed feedback:

Essay:
${essay}

Provide feedback on:
1. Task Achievement (did they answer the question?)
2. Coherence and Cohesion (organization and linking)
3. Lexical Resource (vocabulary range and accuracy)
4. Grammatical Range and Accuracy
5. Estimated IELTS Band Score (6.0-9.0)
6. Specific suggestions for improvement

Be constructive and encouraging while being honest about areas to improve.`;
            
            const result = await callClaudeAI(prompt);
            
            btn.disabled = false;
            btn.textContent = 'ü§ñ Check with AI';
            
            if (result) {
                feedback.innerHTML = `
                    <div class="feedback-box">
                        <h3 style="color: #00b894; margin-bottom: 15px;">ü§ñ AI Feedback</h3>
                        <div style="white-space: pre-wrap; line-height: 1.8;">${result}</div>
                    </div>
                `;
            } else {
                feedback.innerHTML = '';
            }
        }
        
        function clearEssay() {
            document.getElementById('essayInput').value = '';
            document.getElementById('essayFeedback').innerHTML = '';
        }
        
        // Speaking Partner
        function selectTopic(type) {
            document.querySelectorAll('.practice-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.closest('.practice-option').classList.add('selected');
            currentSpeakingTopic = type;
            
            document.getElementById('speakingInput').disabled = false;
            document.getElementById('speakingSendBtn').disabled = false;
            
            startSpeakingSession(type);
        }
        
        async function startSpeakingSession(type) {
            const chat = document.getElementById('speakingChat');
            chat.innerHTML = '<div class="loading"><p>Starting speaking session...</p></div>';
            
            const prompts = {
                'part1': 'You are an IELTS examiner conducting Part 1 (Introduction). Ask the student 3-4 simple questions about familiar topics like work, study, hobbies, or daily life. Keep it conversational.',
                'part2': 'You are an IELTS examiner for Part 2 (Long Turn). Give the student a cue card topic and tell them to speak for 1-2 minutes. Then they will type their answer and you will give feedback.',
                'part3': 'You are an IELTS examiner for Part 3 (Discussion). Ask deeper, more abstract questions about topics like society, technology, education. Be thought-provoking.',
                'free': 'You are a friendly English conversation partner. Have a natural conversation about any topic the student wants to discuss. Be engaging and ask follow-up questions.'
            };
            
            const result = await callClaudeAI('Start the session', prompts[type]);
            
            if (result) {
                chat.innerHTML = `<div class="message ai"><strong>AI Speaking Partner:</strong><br><br>${result}</div>`;
            }
        }
        
        async function sendSpeakingMessage() {
            const input = document.getElementById('speakingInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const btn = document.getElementById('speakingSendBtn');
            btn.disabled = true;
            
            const chat = document.getElementById('speakingChat');
            chat.innerHTML += `<div class="message user">${message}</div>`;
            input.value = '';
            
            chat.innerHTML += '<div class="loading"><div class="spinner"></div></div>';
            chat.scrollTop = chat.scrollHeight;
            
            const systemPrompt = currentSpeakingTopic === 'part1' ? 
                'Continue as IELTS Part 1 examiner. Give brief feedback on their answer, then ask the next question.' :
                currentSpeakingTopic === 'part2' ?
                'Give detailed feedback on their Part 2 response: fluency, vocabulary, grammar, coherence. Be encouraging.' :
                currentSpeakingTopic === 'part3' ?
                'Continue Part 3 discussion. Comment on their answer and ask a follow-up question.' :
                'Continue natural conversation. Comment on what they said and ask a related question.';
            
            const result = await callClaudeAI(message, systemPrompt);
            
            btn.disabled = false;
            
            if (result) {
                const loadingElements = chat.querySelectorAll('.loading');
                loadingElements.forEach(el => el.remove());
                
                chat.innerHTML += `<div class="message ai"><strong>AI Speaking Partner:</strong><br><br>${result}</div>`;
                chat.scrollTop = chat.scrollHeight;
            }
        }
        
        // Grammar Helper
        async function sendGrammarQuestion() {
            const input = document.getElementById('grammarInput');
            const question = input.value.trim();
            
            if (!question) return;
            
            const btn = document.getElementById('grammarSendBtn');
            btn.disabled = true;
            
            const chat = document.getElementById('grammarChat');
            chat.innerHTML += `<div class="message user">${question}</div>`;
            input.value = '';
            
            chat.innerHTML += '<div class="loading"><div class="spinner"></div></div>';
            chat.scrollTop = chat.scrollHeight;
            
            const systemPrompt = 'You are an expert English grammar teacher. Explain grammar concepts clearly with examples. Use simple language and provide 3-4 example sentences to illustrate the point.';
            
            const result = await callClaudeAI(question, systemPrompt);
            
            btn.disabled = false;
            
            if (result) {
                const loadingElements = chat.querySelectorAll('.loading');
                loadingElements.forEach(el => el.remove());
                
                chat.innerHTML += `<div class="message ai"><strong>AI Grammar Teacher:</strong><br><br>${result}</div>`;
                chat.scrollTop = chat.scrollHeight;
            }
        }
        
        // Vocabulary Builder
        async function generateVocabExercise() {
            const topic = document.getElementById('vocabTopic').value.trim();
            const wordList = document.getElementById('vocabList').value.trim();
            
            if (!topic && !wordList) {
                alert('Please enter a topic or paste a word list');
                return;
            }
            
            const btn = document.getElementById('vocabGenBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            
            const container = document.getElementById('vocabExercise');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>AI is generating your personalized exercise...</p></div>';
            
            const prompt = topic ? 
                `Create a 10-question vocabulary exercise for this topic: ${topic}

Include:
1. 5 gap-fill questions (provide context sentence with blank)
2. 5 multiple choice questions (word definitions)

Make it appropriate for B2-C1 level English learners.` :
                `Using this word list, create an interactive exercise:

${wordList}

Include:
1. Gap-fill questions using these words
2. Match definitions
3. Example sentences

Format it clearly with numbered questions.`;
            
            const result = await callClaudeAI(prompt);
            
            btn.disabled = false;
            btn.textContent = 'ü§ñ Generate AI Exercise';
            
            if (result) {
                container.innerHTML = `
                    <div class="feedback-box" style="margin-top: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üéØ Your Personalized Exercise</h3>
                        <div style="white-space: pre-wrap; line-height: 1.8;">${result}</div>
                        <button class="btn-secondary" style="margin-top: 20px;" onclick="generateVocabExercise()">üîÑ Generate New Exercise</button>
                    </div>
                `;
            }
        }
        
        // AI Recommendations
        async function getAIRecommendations() {
            const btn = document.getElementById('recommendBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Analyzing...';
            
            const container = document.getElementById('recommendations');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>AI is analyzing your progress and creating personalized recommendations...</p></div>';
            
            const prompt = `You are an expert English learning advisor. Based on a student who:
- Has access to 5 worksheets (Politics, Business, Crime, Health, Vocabulary)
- Is at B2-C1 level
- Has used AI features ${aiUsageCount} times
- Wants to improve for IELTS or professional English

Provide:
1. Personalized learning plan for the next 2 weeks
2. Which worksheets to focus on and in what order
3. How to use the AI features effectively
4. Daily study routine suggestion
5. Tips for rapid improvement

Be specific and actionable.`;
            
            const result = await callClaudeAI(prompt);
            
            btn.disabled = false;
            btn.textContent = 'ü§ñ Get AI Recommendations';
            
            if (result) {
                container.innerHTML = `
                    <div class="feedback-box" style="margin-top: 30px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üéØ Your Personalized Learning Plan</h3>
                        <div style="white-space: pre-wrap; line-height: 1.8;">${result}</div>
                    </div>
                `;
            }
        }
        
        // Allow Enter key to send messages
        document.addEventListener('DOMContentLoaded', function() {
            const speakingInput = document.getElementById('speakingInput');
            const grammarInput = document.getElementById('grammarInput');
            
            if (speakingInput) {
                speakingInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        if (!this.disabled) sendSpeakingMessage();
                    }
                });
            }
            
            if (grammarInput) {
                grammarInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendGrammarQuestion();
                    }
                });
            }
        });
    </script>
</body>
</html>
